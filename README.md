# 딥러닝과 기술적 분석을 융합한 비트코인 알고리즘 트레이딩

> GRU 모델의 예측 신뢰도와 RSI 지표를 활용한 리스크 관리 중심의 하이브리드 전략 연구

## 1. 프로젝트 개요 및 동기

비트코인 시장은 24시간 열려 있고 변동성이 극심하여, 사람이 직접 대응하기에는 체력적, 심리적 한계가 명확합니다. 따라서 감정을 배제하고 철저히 데이터에 기반하여 매매를 수행하는 알고리즘 트레이딩 시스템의 필요성을 느꼈습니다.

단순히 "내일 가격이 오를까?"를 맞추는 것은 동전 던지기와 다를 바 없습니다. 본 프로젝트의 핵심 목표는 "언제 확실하게 배팅하고, 언제 시장을 관망해야 하는가?"를 판단하는 의사결정 시스템을 구축하는 것입니다. 이를 위해 시계열 패턴 학습에 강한 딥러닝 모델(GRU)을 엔진으로 사용하고, 시장의 과열 여부를 판단하는 보조지표(RSI)를 브레이크로 사용하는 복합 전략을 설계했습니다.

- 작성자: 서채영 (202201750)
- 제출일: 2025년 12월 13일

---

## 2. 컴퓨팅 자원

본 프로젝트는 대용량 시계열 데이터 학습과 딥러닝 모델의 빠른 추론을 위해 GPU 가속 환경에서 수행되었습니다.

- CPU: Intel Xeon Processors @ 2.20GHz (2 vCPUs)
- RAM: 12GB ~ 25GB (High-RAM Runtime)
- OS: Ubuntu 20.04.6 LTS
- Framework: PyTorch 2.0.1+cu118

---

## 3. 데이터 전처리 및 입력 변수

모델이 가격 흐름을 입체적으로 이해할 수 있도록 단순 가격 데이터 외에 다양한 시장 정보를 피처로 가공하여 주입했습니다.

* 기초 데이터: 시가, 고가, 저가, 종가, 거래량 (OHLCV)
* 추세 지표: 이동평균선의 골든크로스/데드크로스 패턴 학습을 위한 기간별 이동평균 값
* 모멘텀 지표: 상대강도지수(RSI), MACD 등을 통해 현재 추세의 강도를 수치화
* 변동성 지표: 볼린저 밴드 등의 변동성 정보를 추가하여 시장 급변 감지

---

## 4. 모델 설계: 왜 GRU인가?

초기에는 가장 대중적인 LSTM 모델을 고려했으나, 실험 결과 GRU(Gated Recurrent Unit)가 본 프로젝트에 더 적합하다고 판단했습니다.

### 4.1 모델 아키텍처의 특징
기존의 장단기 메모리(LSTM) 모델은 강력하지만 구조가 복잡하여 연산량이 많고, 데이터가 적은 경우 과적합(Overfitting)의 위험이 있습니다. 반면, **게이트 순환 유닛(GRU)**은 업데이트 게이트와 리셋 게이트라는 두 개의 문(Gate)만을 사용하여 구조를 간결하게 유지하면서도 장기 기억 능력을 보존합니다. 비트코인처럼 노이즈가 많은 데이터셋에서 더 빠르고 효율적인 학습이 가능하도록 이를 채택했습니다.

### 4.2 계층별 상세 설계 의도
2층 구조의 게이트 순환 유닛 (2-Layer GRU): 한 개의 층만 사용하는 것보다 두 개의 층을 쌓음으로써, 모델이 더 복잡하고 추상적인 시장의 패턴을 학습할 수 있도록 했습니다. 첫 번째 층에서는 기초적인 가격 변동을, 두 번째 층에서는 이들의 조합으로 나타나는 고차원적인 추세를 파악합니다.

전결합층(FC Layer)의 확장: 순환 신경망을 통해 추출된 특징(Feature)들을 바로 출력하지 않고, 32개의 노드를 가진 중간 계층을 추가했습니다. 이는 모델이 판단을 내리기 전 한 번 더 정보를 정제하는 역할을 하며, 복잡한 비선형적 관계를 더 잘 표현할 수 있게 합니다.

드롭아웃(Dropout) 적용 (0.3): 학습 과정에서 무작위로 뉴런의 연결을 끊음으로써, 모델이 특정 데이터에만 과하게 익숙해지는 것을 방지했습니다. 이는 실전 매매에서 과거와 조금 다른 패턴이 나타나더라도 유연하게 대응할 수 있는 일반화 능력을 키워줍니다.

활성화 함수와 출력: 중간층에는 **정류 선형 유닛(ReLU)**을 사용하여 학습 속도를 높였고, 마지막 출력층에는 시그모이드(Sigmoid) 함수를 배치했습니다. 이를 통해 모델은 단순히 '오른다/내린다'가 아니라, 0에서 1 사이의 확률값을 내놓게 됩니다. 이 확률값이 앞서 언급한 **투자 레벨(Level 1~4)**을 결정하는 핵심 지표가 됩니다.

```python
# [Level 3] 1. GRU 모델 정의 및 학습
import torch.nn as nn
import torch.optim as optim

class MyTradingModel(nn.Module):
    def __init__(self, input_size, hidden_size=128, num_layers=2, dropout=0.3):
        super(MyTradingModel, self).__init__()
        # LSTM 대신 GRU 사용 (구조 개선)
        self.gru = nn.GRU(input_size, hidden_size, num_layers, batch_first=True, dropout=dropout)
        # 분류기 성능 강화를 위한 FC 레이어 확장
        self.fc = nn.Sequential(
            nn.Linear(hidden_size, 32),
            nn.ReLU(),
            nn.Dropout(dropout),
            nn.Linear(32, 1),
            nn.Sigmoid()
        )
        
    def forward(self, x):
        # x: (batch, seq_len, features)
        out, _ = self.gru(x)
        # 마지막 시점(=가장 최근 데이터)의 출력만 사용
        out = out[:, -1, :] 
        out = self.fc(out)
        return out

# 모델 생성 (파라미터 증강)
my_model = MyTradingModel(
    input_size=X_train_seq.shape[2],
    hidden_size=128, 
    num_layers=2,
    dropout=0.3
).to(device)
```

---

## 5. 트레이딩 전략: 인공지능과 기술적 지표의 복합 시스템
레벨 4 전략은 단순히 게이트 순환 유닛(GRU) 모델의 예측값에만 의존하지 않고, 시장의 과열 및 과매도 상태를 나타내는 상대강도지수(RSI)를 결합한 하이브리드 의사결정 시스템입니다. 이는 모델이 놓칠 수 있는 단기적 과열이나 과도한 하락 구간에서의 반등 기회를 포착하기 위한 설계입니다.

### 5.1 전략의 이단계 필터링 구조
본 전략은 '모델의 확신'과 '시장의 에너지'를 동시에 검토하는 두 단계의 필터링 과정을 거칩니다.

#### 1단계: 인공지능 모델 기반의 기초 비중 결정 
먼저 게이트 순환 유닛(GRU) 모델이 출력한 상승 확률(p)을 확인합니다. 
- 상승 확률 50% 초과: 시장이 우상향할 것으로 판단하고, P x 1.2의 산식을 적용하여 기초 투자 비중을 결정합니다. 확률이 높을수록 더 공격적으로 비중을 실어주는 구조입니다.
- 상승 확률 50% 이하: 하락 가능성이 높다고 판단하여 기초 투자 비중을 0으로 설정합니다.

#### 2단계: 상대강도지수(RSI)를 통한 비중 보정 (최종 비율)
결정된 기초 비중은 현재 시장의 심리적 상태인 상대강도지수에 따라 다시 한 번 조정됩니다.

- 리스크 관리 (과매수 구간, 상대강도지수 70 이상): 모델이 상승을 예측하더라도 시장이 이미 뜨겁게 달구어진 상태라면, 고점 신호로 판단하여 기초 비중의 50%를 축소합니다. 이는 '어깨에서 파는' 리스크 관리를 실현합니다.

- 적극적 기회 포착 (과매도 구간, 상대강도지수 30 이하): 시장이 과하게 하락한 상태라면 반등 가능성이 높다고 보고, 기초 비중을 1.5배 확대합니다. 특히 모델의 확신이 다소 부족한 상황(상승 확률 40%~50%)이라도, 상대강도지수가 30 이하라면 30%의 소액 진입을 시도하는 역발상 투자 로직이 포함되어 있습니다.

- 중립 구간: 상대강도지수가 30에서 70 사이인 일반적인 상황에서는 모델의 판단(기초 비중)을 그대로 유지합니다.

#### 5.2 자산 재배분 및 거래 비용 최적화
결정된 최종 비중(Final Ratio)은 실시간으로 전체 포트폴리오 가치에 반영됩니다.

- 동적 자산 재배분 (Rebalancing): 현재 보유한 비트코인의 가치와 전략이 요구하는 목표 가치 사이의 차액만큼만 매수 또는 매도합니다. 이를 통해 자본 효율성을 높입니다.

- 거래 수수료 반영: 모든 매매 시 발생할 수 있는 0.1%의 수수료를 계산식에 포함하여, 실전 매매 환경과 유사한 수익률 결과를 도출하도록 설계했습니다.
- 
```python
# [전략 핵심 로직 요약]
# 1. 모델 확률(prob)이 0.5를 넘으면 공격적인 가중치(1.2배)를 주어 기본 비중 설정
if prob > 0.5:
    base_ratio = min(prob * 1.2, 1.0)
else:
    base_ratio = 0

# 2. 시장 상황(상대강도지수)에 따른 2차 보정
if rsi > 70:    # 과매수: 비중 절반으로 축소 (방어적)
    final_ratio = base_ratio * 0.5
elif rsi < 30:  # 과매도: 비중 1.5배 확대 (공격적)
    final_ratio = min(base_ratio * 1.5, 1.0)
    # 모델 확률이 조금 낮아도 과매도 구간이면 저점 매수 수행
    if prob > 0.4 and base_ratio == 0:
        final_ratio = 0.3
```

---

## 6. 결과 분석 및 고찰

### 6.1 성과 분석 요약
- **최종 수익률**: 6.94%
- **Buy and Hold 대비**: +11.46%p (Buy and Hold: -4.52%)
- **거래 횟수**: 48회

테스트 기간(2023년) 동안 비트코인 시장은 변동성이 컸음에도 불구하고, 제안된 Level 4 Composite 전략은 시장 수익률을 크게 상회하는 성과를 거두었습니다. 특히 단순 보유 전략이 손실(-4.52%)을 기록한 반면, 본 전략은 수익(+6.94%)을 창출함으로써 +11.46%p의 Alpha를 달성했습니다.

### 6.2 전략의 유효성 분석
본 전략은 LSTM 모델의 예측 확률과 RSI 보조지표를 결합하여 설계되었습니다.
- 모델 확신도 기반 진입: `prob > 0.65`일 때만 진입하고, 확률에 비례하여(`prob * 1.2`) 투자를 집행함으로써 불확실한 구간에서의 손실을 방지했습니다.
- RSI 필터링의 효과: 
  - 과매수(`RSI > 70`) 구간에서 비중을 50% 축소하여 고점 매수 위험을 줄였습니다.
  - 과매도(`RSI < 30`) 구간에서는 비중을 1.5배 확대하되, 모델 확률이 0.4 이상이기만 해도 소액(30%) 진입하는 역발상 로직을 통해 저점 매수 기회를 포착했습니다.

### 6.3 개선점 및 향후 과제
- 모델 고도화: 현재 3-Layer LSTM 구조를 Transformer 기반의 Time-Series 모델로 발전시키거나, GRU 등을 실험해 볼 수 있습니다.
- 피처 확장: 가격/거래량 데이터 외에도 온체인 데이터(활성 주소 수, 해시레이트 등)나 뉴스 심리지수(Fear & Greed Index)를 포함하면 예측력을 높일 수 있습니다.
- 리스크 관리: 급격한 하락장에 대비한 Trailing Stop이나 변동성(ATR) 기반의 손절매 로직을 추가한다면 MDD(최대 낙폭)를 더욱 줄일 수 있을 것입니다.

### 6.4 결론
본 과제를 통해 딥러닝 모델의 예측값만 의존하기보다는, 기술적 지표(RSI)와 결합한 하이브리드 전략이 실전 트레이딩에서 훨씬 안정적이고 높은 성과를 낼 수 있음을 확인했습니다.

---

## 7. 결론 및 향후 연구 과제
이번 프로젝트는 단순히 딥러닝 모델을 돌려보는 것을 넘어, 실제 트레이딩에서 수익을 내기 위해 어떤 고민이 필요한지를 깨닫는 과정이었습니다. 특히 모델의 정확도보다 중요한 것은 대응 전략이라는 사실을 배웠습니다.

하지만 아쉬운 점도 있습니다. 금융 시장의 노이즈로 인해 모델의 기본 예측 정확도는 50% 중반대에 머물렀습니다. 향후에는 최신 어텐션 메커니즘인 트랜스포머(Transformer)를 도입하여 시계열 데이터의 장기 의존성을 더 잘 포착하거나, 뉴스 기사의 감성 지수 및 온체인 데이터를 입력 변수로 추가하여 차트 밖의 정보까지 반영하는 방향으로 모델을 개선해보고 싶습니다. 또한 실전 매매를 가정하여 슬리피지 비용을 모델링에 포함하고, 급락 시 자산을 보호할 자동 손절매 로직을 추가할 계획입니다.
